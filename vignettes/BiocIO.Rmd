---
title: "Vignette Title"
author:
- name: Daniel Van Twisk
  affiliation: Roswell Park Comprehensive Cancer Center
- name: Martin Morgan
  affiliation: Roswell Park Comprehensive Cancer Center
  email: maintainer@biocondcutor.org
package: BiocIO
output:
  BiocStyle::html_document
abstract: |
  BiocIO contains defintions for import and export methods used throughout
  Biocondcutor for IO purposes. The BiocFile class which serves as an interface
  for File classes within Bioconductor is also defined in this package. This
  vignette will describe the functionality of these base methods and classes as
  well as an example for developers on how to interface with them.
vignette: |
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

# Installation
```{r installation, eval=FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("BiocIO")
```

# Introduction
```{r library}
library("BiocIO")
```
## Import and Export
The functions import and export load and save objects from and to particular
file formats. This package contains the following generics for the import
and export methods used throughout the Bioconductor package suite.
```{r importexportGeneirc}
getGeneric("import")
getGeneric("export")
```

## Yield

```{r yieldGeneric}
getGeneric("yield")
```

## The BiocFile Class
BiocFile is a base class for high-level file abstractions, where subclasses are
associated with a particular file format/type. It wraps a low-level
representation of a file, currently either a path/URL or connection.

## CompressedFile

CompressedFile is a base class that extends the BiocFile class that offers
high-level file abstractions for compressed file formats. As with the BiocFile
class, it takes either a path/URL of connection as an arguement. This package
also includes other File classes that extend CompressedFile including: BZ2File,
XZFile, GZFile, and BGZFile which extends the GZfile class

# For developers

The primary purpose of this package is to provide high-level classes and
generics to facilitate file IO within the Biocondcutor package suite. The
remainder of this vignette will detail how to create File classes that extend
the BiocFile class and create methods for these classes. This section will also
detail using the filter and select methods from the tidyverse dplyr package to
facilitate lazy operations on files.

The CSVFile class defined in this package will be used as an example. The
purpose of the CSVFile class is to represent CSVFile so that IO operations can
be performed on the file. The following code defines the CSVFile class that
extends the BiocFile class using the `contains` argument. The CSVFile function
is used as a constructor function requiring only the argument `resource` (either
a `character` or a `connection`).

```{r defineCSVFile}
.CSVFile <- setClass("CSVFile", contains = "BiocFile")

CSVFile <-
    function(resource)
{
    .CSVFile(resource = resource)
}
```

Next, the import and export functions are defined. These functions are meant to
import the data into R in a usable format (a `data.frame` or another
user-friendly R class), then export that R object into a file. For the CSVFile
example, the base `read.csv()` and `write.csv()` functions are used as the body
for our methods.
```{r defineImportExport}
setMethod("import", "CSVFile",
    function(con, format, text, ...)
{
    read.csv(resource(con), ...)
})

setMethod("export", "data.frame", "CSVFile",
    function(object, con, format, ...)
{
    write.csv(object, resource(con), ...)
})
```

The yield method is meant to return only a certain amount of the File object
using the `size` argument. The `size` argument can be anything defined as any
means to split the object and is defined by the developer for each yield method.
For the `CSVFile` class, it is defined as rows.

```{r defineYield}
setMethod("yield", "CSVFile",
    function(con, format, text, size = -1, ...)
{
    con <- resource(con)
    if (!is(con, "connection"))
        con <- file(con)
    if (!identical("opened", summary(con)$opened))
        tryCatch({
            open(con, "rt")
        }, error = function(e) {
            cond <- simpleCondition(e)
            class(cond) <- c("File not found", class(cond))
            signalCondition(cond)
        })
    tryCatch({
        read.csv(con, nrows = size, ...)
    }, error = function(e) {
        cond <- simpleCondition(e)
        class(cond) <- c("EOF", class(cond))
        signalCondition(cond)
    })
})
```

And finally a demonstration of the CSVFile class and import/export methods in
action.
```{r demonstrateCSV}
temp <- tempfile(fileext = ".csv")
csv <- CSVFile(temp)

export(mtcars, csv)
df <- import(csv)

yield(csv)
```


## Session info {.unnumbered}

```{r sessionInfo, echo=FALSE}
sessionInfo()
```
